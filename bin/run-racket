#! /bin/sh
PROGRAM=`echo $0 | sed 's%.*/%%'`
PROGDIR="$(cd `dirname $0`; echo $PWD)"

if [ ! -z "$ZSH_VERSION" ]; then
  setopt shwordsplit
fi

RACKET="${RACKET:-env racket}"
RACKET_PRELUDE=""
if [ $# -lt 2 ]; then
    echo "No."
    exit -1
fi

VARIABLE=$1
shift
BENCHMARK=$1
shift

BENCH_FILE="${BENCHMARK}.scm"
OUT="racket/${BENCHMARK}${VARIABLE}.rkt"

if egrep -q 'set-c[ad]r!' "src/$BENCH_FILE" ; then
    MCONS="/mcons"
else
    MCONS=""
fi

printf "`cat configuration/pycket.tmpl`\n" "pycket/mcons" \
       "$RACKET_PRELUDE" \
        "pycket" "" "pycket" "$VARIABLE" \
       "$BENCH_FILE" > "$OUT";

exec $RACKET ${RACKET_ARGS} "$@" "$OUT" $EXTRA_ARG
