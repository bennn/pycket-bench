#! /bin/bash
PROGRAM=`echo $0 | sed 's%.*/%%'`
PROGDIR="$(cd `dirname $0`; echo $PWD)"

if [ ! -z "$ZSH_VERSION" ]; then
  setopt shwordsplit
fi

RACKET="${RACKET:-env racket}"
RACKET_PRELUDE=""
if [ $# -lt 2 ]; then
    echo "No."
    exit -1
fi

VARIABLE=$1
shift
BENCHMARK=$1
shift


if [ "$VARIABLE" = "PURE" ]; then
    OUT="src/${BENCHMARK}.rkt"
else
    OUT="racket/${BENCHMARK}${VARIABLE}.rkt"

    if egrep -q 'set-c[ad]r!' "src/${BENCHMARK}.scm" ; then
        RFRS=" r5rs"
    else
        RFRS=""
    fi

    printf "(module %s pycket/wrap%s %s)\n" \
           "${BENCHMARK}" "${RFRS}" "${VARIABLE:1}" \
           > "$OUT";
fi

raco make "$OUT"

exec $RACKET ${RACKET_ARGS} "$OUT" "$@"
